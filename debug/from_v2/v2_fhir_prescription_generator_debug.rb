require "base64"
require './lib/from_v2/v2_fhir_prescription_generator'
require_relative 'v2_examples'

filename = File.join(File.dirname(__FILE__), "example_iso2022jp.txt")
params = {
    encoding: "ISO-2022-JP",
    prefecture_code: "13",
    medical_fee_point_code: "1",
    medical_institution_code: "9999999",
    message: Base64.encode64(File.read(filename, encoding: "iso_2022_jp")),
}
generator = V2FhirPrescriptionGenerator.new(params).perform
result = generator.get_resources.to_json
puts result
__END__

iso_2022_jp
TVNIfF5+XCZ8SEw3djJ8MTMxOTk5OTk5OXxITDdGSElSfDEzMTk5OTk5OTl8\nMjAxNjA4MjExNjE1MjN8fFJERV5PMTFeUkRFX08xMXwyMDE2MDgyMTE2MTUy\nMzAxNDN8UHwyLjV8fHx8fHx+SVNPSVI4N3x8SVNPIDIwMjItMTk5NApQSUR8\nfHwxMDAwMDAwMDAxXl5eXlBJfHwbJEI0NTxUGyhCXhskQkJATzobKEJeXl5e\nXkxeSX4bJEIlKyVzJTglYxsoQl4bJEIlPyVtJSYbKEJeXl5eXkxeUHx8MTk3\nOTExMDF8TXx8fF5eGyRCPUJDKzZoGyhCXhskQkVsNX5FVBsoQl4xNTEwMDcx\nXkpQTl5IXhskQkVsNX5FVD1CQys2aEtcRC47MEN6TFwjMSMyITwjMRsoQnx8\nXlBSTl5QSF5eXl5eXl5eXjAzLTEyMzQtNTY3OHx8fHx8fHx8fHx8Tnx8fHx8\nfE58fHwyMDE2MTAyODE0MzMwOQpJTjF8MXwwNl4bJEJBSDlnNEk+ODdyOS9K\nXTgxGyhCXkpIU0QwMDAxfDA2MDUwMTE2fHx8fHx8fBskQiM5IzIjMCM0IzUb\nKEJ8GyRCIzEjMBsoQnwxOTk5MDUxNHx8fHx8U0VMXhskQktcP00bKEJeSEw3\nMDA2MwpPUkN8Tld8MTIzNDU2Nzh8fDEyMzQ1Njc4XzAxfHx8fHwyMDE2MDgy\nNXx8fDEyMzQ1Nl4bJEIwZTtVGyhCXhskQj1VO1IbKEJeXl5eXl5eTF5eXl5e\nSX5eGyRCJSQlNxsoQl4bJEIlTyVrJTMbKEJeXl5eXl5eTF5eXl5eUHx8fHx8\nMDFeGyRCRmIyShsoQl45OVowMXx8fHwbJEIlYSVJJWwhPCUvJWolSyVDJS8b\nKEJ8Xl4bJEI5QTZoGyhCXhskQkVsNX5FVBsoQl5eSlBOXl4bJEJFbDV+RVQ5\nQTZoTztLXExaIzMhXSMyIV0jMRsoQnx8fHx8fHxPXhskQjMwTWg0NTxUJSoh\nPCVAGyhCXkhMNzA0ODIKUlhFfHwxMDM4MzU0MDFeGyRCJWAlMyVAJSQlcz57\nIzIjNSMwI20jZxsoQl5IT1R8MXx8VEFCXhskQj57GyhCXk1SOVB8VEFCXhsk\nQj57GyhCXk1SOVB8MDFeGyRCIzEyc0xcJCskaUl+TVEbKEJeSkhTUDAwMDV8\nfHw5fFRBQl4bJEI+exsoQl5NUjlQfHx8fHx8fHwzXlRBQiYbJEI+exsoQiZN\nUjlQfHxPSFBeGyRCMzBNaD1oSn0bKEJeTVI5UH5PSEleGyRCMSFGYj1oSn0b\nKEJeTVI5UHx8fHx8fDIxXhskQkZiSX4bKEJeSkhTUDAwMDMKVFExfHx8MTAx\nMzA0NDQwMDAwMDAwMCYbJEJGYkl+ISY3UDh9ISYjMUZ8IzMyc0QrQ2tNPD8p\nOGUbKEImSkFNSVNEUDAxfHx8M15EJhskQkZ8GyhCJklTTyt8MjAxNjA4MjUK\nUlhSfFBPXhskQjh9GyhCXkhMNzAxNjIKT1JDfE5XfDEyMzQ1Njc4fHwxMjM0\nNTY3OF8wMXx8fHx8MjAxNjA4MjV8fHwxMjM0NTZeGyRCMGU7VRsoQl4bJEI9\nVTtSGyhCXl5eXl5eXkxeXl5eXkl+XhskQiUkJTcbKEJeGyRCJU8layUzGyhC\nXl5eXl5eXkxeXl5eXlB8fHx8fDAxXhskQkZiMkobKEJeOTlaMDF8fHx8GyRC\nJWElSSVsITwlLyVqJUslQyUvGyhCfF5eGyRCOUE2aBsoQl4bJEJFbDV+RVQb\nKEJeXkpQTl5eGyRCRWw1fkVUOUE2aE87S1xMWiMzIV0jMiFdIzEbKEJ8fHx8\nfHx8T14bJEIzME1oNDU8VCUqITwlQBsoQl5ITDcwNDgyClJYRXx8MTEwNjI2\nOTAxXhskQiVRJXMlOSVdJWolcyNUPnsjMSMwIzAbKEIgGyRCIzEjMCMwI20j\nZxsoQl5IT1R8Mnx8VEFCXhskQj57GyhCXk1SOVB8VEFCXhskQj57GyhCXk1S\nOVB8MDFeGyRCIzEyc0xcJCskaUl+TVEbKEJeSkhTUDAwMDV8fHwxOHxUQUJe\nGyRCPnsbKEJeTVI5UHx8fHx8fHx8Nl5UQUImGyRCPnsbKEImTVI5UHx8T0hQ\nXhskQjMwTWg9aEp9GyhCXk1SOVB+T0hJXhskQjEhRmI9aEp9GyhCXk1SOVB8\nfHx8fHwyMV4bJEJGYkl+GyhCXkpIU1AwMDAzClRRMXx8fDEwMTMwNDQ0MDAw\nMDAwMDAmGyRCRmJJfiEmN1A4fSEmIzFGfCMzMnNEK0NrTTw/KThlGyhCJkpB\nTUlTRFAwMXx8fDNeRCYbJEJGfBsoQiZJU08rfDIwMTYwODI1ClJYUnxQT14b\nJEI4fRsoQl5ITDcwMTYyCk9SQ3xOV3wxMjM0NTY3OHx8MTIzNDU2NzhfMDJ8\nfHx8fDIwMTYwODI1fHx8MTIzNDU2XhskQjBlO1UbKEJeGyRCPVU7UhsoQl5e\nXl5eXl5MXl5eXl5Jfl4bJEIlJCU3GyhCXhskQiVPJWslMxsoQl5eXl5eXl5M\nXl5eXl5QfHx8fHwwMV4bJEJGYjJKGyhCXjk5WjAxfHx8fBskQiVhJUklbCE8\nJS8laiVLJUMlLxsoQnxeXhskQjlBNmgbKEJeGyRCRWw1fkVUGyhCXl5KUE5e\nXhskQkVsNX5FVDlBNmhPO0tcTFojMyFdIzIhXSMxGyhCfHx8fHx8fE9eGyRC\nMzBNaDQ1PFQlKiE8JUAbKEJeSEw3MDQ4MgpSWEV8fDEwMDc5NTQwMl4bJEIl\nXCVrJT8lbCVzPnsjMiM1I20jZxsoQl5IT1R8MXx8VEFCXhskQj57GyhCXk1S\nOVB8fHx8fDEwfFRBQl4bJEI+exsoQl5NUjlQfHx8fHx8fHx8fE9IUF4bJEIz\nME1oPWhKfRsoQl5NUjlQfk9ISV4bJEIxIUZiPWhKfRsoQl5NUjlQfHx8fHx8\nMjJeGyRCRlxNURsoQl5KSFNQMDAwMwpUUTF8fHwxMDUwMTEwMDIwMDAwMDAw\nJhskQkZiSX4hJjdQOH0hJmFWREs7fhsoQiZKQU1JU0RQMDF8fHx8MjAxNjA4\nMjV8fHx8MSAbJEJGfBsoQjIgGyRCMnMkXiRHGyhCfHx8MTAKUlhSfFBPXhsk\nQjh9GyhCXkhMNzAxNjIKT1JDfE5XfDEyMzQ1Njc4fHwxMjM0NTY3OF8wM3x8\nfHx8MjAxNjA4MjV8fHwxMjM0NTZeGyRCMGU7VRsoQl4bJEI9VTtSGyhCXl5e\nXl5eXkxeXl5eXkl+XhskQiUkJTcbKEJeGyRCJU8layUzGyhCXl5eXl5eXkxe\nXl5eXlB8fHx8fDAxXhskQkZiMkobKEJeOTlaMDF8fHx8GyRCJWElSSVsITwl\nLyVqJUslQyUvGyhCfF5eGyRCOUE2aBsoQl4bJEJFbDV+RVQbKEJeXkpQTl5e\nGyRCRWw1fkVUOUE2aE87S1xMWiMzIV0jMiFdIzEbKEJ8fHx8fHx8T14bJEIz\nME1oNDU8VCUqITwlQBsoQl5ITDcwNDgyClJYRXx8MTA2MjM4MDAxXhskQiU4\nJVUlaSE8JWtGcDlRIzAhJSMwIzUhcxsoQl5IT1R8IiJ8fCIifE9JVF4bJEJG\ncDlRGyhCXk1SOVB8fHx8MnxIT05eGyRCS1wbKEJeTVI5UHx8fHx8fHx8fHxP\nSFBeGyRCMzBNaD1oSn0bKEJeTVI5UH5PSE9eGyRCMSEzMD1oSn0bKEJeTVI5\nUHx8fHx8fDIzXhskQjMwTVEbKEJeSkhTUDAwMDMKVFExfHx8MkI3NDAwMDAw\nMDAwMDAwMCYbJEIzME1RISZFSUlbISYjMUZ8IzQycxsoQiZKQU1JU0RQMDF8\nfHx8MjAxNjA4MjUKUlhSfEFQXhskQjMwTVEbKEJeSEw3MDE2Mnw3N0xeGyRC\nOjg8ahsoQl5KQU1JU0RQMDEK\n

utf-8
TVNIfF5+JnxITDd2MnwxMzE5OTk5OTk5fEhMN0ZISVJ8MTMxOTk5OTk5OXwyMDE2MDgyMTE2MTUyM3x8UkRFXk8xMV5SREVfTzExfDIwMTYwODIxMTYxNTIzMDE0M3xQfDIuNXx8fHx8fH5JU09JUjg3fHxJU08gMjAyMi0xOTk0ClBJRHx8fDEwMDAwMDAwMDFeXl5eUEl8fOaCo+iAhV7lpKrpg45eXl5eXkxeSX7jgqvjg7Pjgrjjg6Ne44K/44Ot44KmXl5eXl5MXlB8fDE5NzkxMTAxfE18fHxeXua4i+iwt+WMul7mnbHkuqzpg71eMTUxMDA3MV5KUE5eSF7mnbHkuqzpg73muIvosLfljLrmnKznlLrkuInkuIHnm67vvJHvvJLjg7zvvJF8fF5QUk5eUEheXl5eXl5eXl4wMy0xMjM0LTU2Nzh8fHx8fHx8fHx8fE58fHx8fHxOfHx8MjAxNjEwMjgxNDMzMDkKSU4xfDF8MDZe57WE5ZCI566h5o6M5YGl5bq35L+d6Zm6XkpIU0QwMDAxfDA2MDUwMTE2fHx8fHx8fO+8me+8ku+8kO+8lO+8lXzvvJHvvJB8MTk5OTA1MTR8fHx8fFNFTF7mnKzkurpeSEw3MDA2MwpPUkN8Tld8MTIzNDU2Nzh8fDEyMzQ1Njc4XzAxfHx8fHwyMDE2MDgyNXx8fDEyMzQ1Nl7ljLvluKte5pil5a2QXl5eXl5eXkxeXl5eXkl+XuOCpOOCt17jg4/jg6vjgrNeXl5eXl5eTF5eXl5eUHx8fHx8MDFe5YaF56eRXjk5WjAxfHx8fOODoeODieODrOODvOOCr+ODquODi+ODg+OCr3xeXua4r+WMul7mnbHkuqzpg71eXkpQTl5e5p2x5Lqs6YO95riv5Yy65YWt5pys5pyo77yT4oiS77yS4oiS77yRfHx8fHx8fE9e5aSW5p2l5oKj6ICF44Kq44O844OAXkhMNzA0ODIKUlhFfHwxMDM4MzU0MDFe44Og44Kz44OA44Kk44Oz6Yyg77yS77yV77yQ772N772HXkhPVHwxfHxUQUJe6YygXk1SOVB8VEFCXumMoF5NUjlQfDAxXu+8keWbnuebruOBi+OCieacjeeUqF5KSFNQMDAwNXx8fDl8VEFCXumMoF5NUjlQfHx8fHx8fHwzXlRBQibpjKAmTVI5UHx8T0hQXuWkluadpeWHpuaWuV5NUjlQfk9ISV7pmaLlhoXlh6bmlrleTVI5UHx8fHx8fDIxXuWGheacjV5KSFNQMDAwMwpUUTF8fHwxMDEzMDQ0NDAwMDAwMDAwJuWGheacjeODu+e1jOWPo+ODu++8keaXpe+8k+WbnuacneaYvOWklemjn+W+jCZKQU1JU0RQMDF8fHwzXkQm5pelJklTTyt8MjAxNjA4MjUKUlhSfFBPXuWPo15ITDcwMTYyCk9SQ3xOV3wxMjM0NTY3OHx8MTIzNDU2NzhfMDF8fHx8fDIwMTYwODI1fHx8MTIzNDU2XuWMu+W4q17mmKXlrZBeXl5eXl5eTF5eXl5eSX5e44Kk44K3XuODj+ODq+OCs15eXl5eXl5MXl5eXl5QfHx8fHwwMV7lhoXnp5FeOTlaMDF8fHx844Oh44OJ44Os44O844Kv44Oq44OL44OD44KvfF5e5riv5Yy6XuadseS6rOmDvV5eSlBOXl7mnbHkuqzpg73muK/ljLrlha3mnKzmnKjvvJPiiJLvvJLiiJLvvJF8fHx8fHx8T17lpJbmnaXmgqPogIXjgqrjg7zjg4BeSEw3MDQ4MgpSWEV8fDExMDYyNjkwMV7jg5Hjg7Pjgrnjg53jg6rjg7PvvLTpjKDvvJHvvJDvvJAg77yR77yQ77yQ772N772HXkhPVHwyfHxUQUJe6YygXk1SOVB8VEFCXumMoF5NUjlQfDAxXu+8keWbnuebruOBi+OCieacjeeUqF5KSFNQMDAwNXx8fDE4fFRBQl7pjKBeTVI5UHx8fHx8fHx8Nl5UQUIm6YygJk1SOVB8fE9IUF7lpJbmnaXlh6bmlrleTVI5UH5PSEle6Zmi5YaF5Yem5pa5Xk1SOVB8fHx8fHwyMV7lhoXmnI1eSkhTUDAwMDMKVFExfHx8MTAxMzA0NDQwMDAwMDAwMCblhoXmnI3jg7vntYzlj6Pjg7vvvJHml6XvvJPlm57mnJ3mmLzlpJXpo5/lvowmSkFNSVNEUDAxfHx8M15EJuaXpSZJU08rfDIwMTYwODI1ClJYUnxQT17lj6NeSEw3MDE2MgpPUkN8Tld8MTIzNDU2Nzh8fDEyMzQ1Njc4XzAyfHx8fHwyMDE2MDgyNXx8fDEyMzQ1Nl7ljLvluKte5pil5a2QXl5eXl5eXkxeXl5eXkl+XuOCpOOCt17jg4/jg6vjgrNeXl5eXl5eTF5eXl5eUHx8fHx8MDFe5YaF56eRXjk5WjAxfHx8fOODoeODieODrOODvOOCr+ODquODi+ODg+OCr3xeXua4r+WMul7mnbHkuqzpg71eXkpQTl5e5p2x5Lqs6YO95riv5Yy65YWt5pys5pyo77yT4oiS77yS4oiS77yRfHx8fHx8fE9e5aSW5p2l5oKj6ICF44Kq44O844OAXkhMNzA0ODIKUlhFfHwxMDA3OTU0MDJe44Oc44Or44K/44Os44Oz6Yyg77yS77yV772N772HXkhPVHwxfHxUQUJe6YygXk1SOVB8fHx8fDEwfFRBQl7pjKBeTVI5UHx8fHx8fHx8fHxPSFBe5aSW5p2l5Yem5pa5Xk1SOVB+T0hJXumZouWGheWHpuaWuV5NUjlQfHx8fHx8MjJe6aCT55SoXkpIU1AwMDAzClRRMXx8fDEwNTAxMTAwMjAwMDAwMDAm5YaF5pyN44O757WM5Y+j44O755a855eb5pmCJkpBTUlTRFAwMXx8fHwyMDE2MDgyNXx8fHwxIOaXpTIg5Zue44G+44GnfHx8MTAKUlhSfFBPXuWPo15ITDcwMTYyCk9SQ3xOV3wxMjM0NTY3OHx8MTIzNDU2NzhfMDN8fHx8fDIwMTYwODI1fHx8MTIzNDU2XuWMu+W4q17mmKXlrZBeXl5eXl5eTF5eXl5eSX5e44Kk44K3XuODj+ODq+OCs15eXl5eXl5MXl5eXl5QfHx8fHwwMV7lhoXnp5FeOTlaMDF8fHx844Oh44OJ44Os44O844Kv44Oq44OL44OD44KvfF5e5riv5Yy6XuadseS6rOmDvV5eSlBOXl7mnbHkuqzpg73muK/ljLrlha3mnKzmnKjvvJPiiJLvvJLiiJLvvJF8fHx8fHx8T17lpJbmnaXmgqPogIXjgqrjg7zjg4BeSEw3MDQ4MgpSWEV8fDEwNjIzODAwMV7jgrjjg5Xjg6njg7zjg6vou5/oho/vvJDvvI7vvJDvvJXvvIVeSE9UfCIifHwiInxPSVRe6Luf6IaPXk1SOVB8fHx8MnxIT05e5pysXk1SOVB8fHx8fHx8fHx8T0hQXuWkluadpeWHpuaWuV5NUjlQfk9IT17pmaLlpJblh6bmlrleTVI5UHx8fHx8fDIzXuWklueUqF5KSFNQMDAwMwpUUTF8fHwyQjc0MDAwMDAwMDAwMDAwJuWklueUqOODu+Whl+W4g+ODu++8keaXpe+8lOWbniZKQU1JU0RQMDF8fHx8MjAxNjA4MjUKUlhSfEFQXuWklueUqF5ITDcwMTYyfDc3TF7lt6bmiYteSkFNSVNEUDAxCg==